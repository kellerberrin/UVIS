"use strict";

/* Controllers */

var USDrugControllers = angular.module("USDrugControllers", []);

    USDrugControllers.controller("DrugSearchCtrl",
        [ "$scope"
        , "$materialToast"
        , "USDrugDatabase"
        , "USDrugEndPoints"
        , function DrugSearchCtrl($scope, $materialToast, USDrugDatabase, USDrugEndPoints) {

            $scope.searchtypes  =  [ { type : "name", typeprompt : "Name", defaulttext : "Livalo" }
                                   , { type : "active", typeprompt : "Ingredient", defaulttext : "" }
                                   , { type : "ndc" , typeprompt : "Code (NDC)" , defaulttext : "" } ];

            $scope.search = { type: $scope.searchtypes[0].type, text: $scope.searchtypes[0].defaulttext };

            $scope.performSearch = function() {

                $scope.requestTime = Date.now();
                var searchParams = {searchstring : $scope.search.text , searchtype : $scope.search.type};
                USDrugEndPoints.typeSearch(searchParams, function(data) {
                    $scope.resultTime = Date.now();
                    $scope.requestResults = data;
                    k_consoleLog($scope.requestResults);
                    $scope.resultToast();
                });

            };

            $scope.resultToast = function() {

                var ToastText =  "Search found " + $scope.requestResults.NDCEnhancedArraySize + " drugs "
                                 + "(" + (($scope.resultTime - $scope.requestTime) / 1000) + " secs)";

                var ToastOptions = { template: "<material-toast>" + ToastText + "</material-toast>", duration: 3000 };

                $materialToast.show(ToastOptions);

            }


        }]);

