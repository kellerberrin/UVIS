

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Local Installation: &mdash; UVIS</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="UVIS" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> Kellerberrin</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../contact/contact.html">Contact Kellerberrin Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../counterfeit/counterfeit.html">Validated Inventory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#serialization">Serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#location">Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#trust-hierarchy">Trust Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#prototype-screen-shots">Prototype Screen Shots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../counterfeit/counterfeit.html#implementation">Implementation</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Kellerberrin</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Local Installation:</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/software/drupal/drupal.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <span class="target" id="drupaldoc"></span><a class="reference internal image-reference" href="../../_images/drupal.jpg"><img alt="../../_images/drupal.jpg" class="align-left" src="../../_images/drupal.jpg" style="width: 136px; height: 143px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="section" id="local-installation">
<h1>Local Installation:<a class="headerlink" href="#local-installation" title="Permalink to this headline">¶</a></h1>
<p>Install a <strong>LAMP</strong> stack (Apache2 and Mysql) using the appropriate software downloads.</p>
<p>Note that &#8220;ServerName localhost&#8221; was added to /etc/apache2/apach2.conf to suppress a warning and ensure that the apache web listens to <strong>localhost:80</strong>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Install <strong>phpmyAdmin</strong> this will use the same password as the mySQL root password defined blow.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>(optional) Install drush - a Drupal download and configuration utility.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Important</strong> Configure the apache server correcty by enabling the rewrite module.</p>
<div class="highlight-python"><div class="highlight"><pre>sudo a2enmod rewrite
</pre></div>
</div>
<p>And enabling <strong>AllowOverride All</strong> on any virtualhost records in <strong>/etc/apache2/sites-available</strong></p>
<div class="highlight-python"><div class="highlight"><pre>&lt;VirtualHost *:80&gt;
. . .
ServerName  example.com
ServerAdmin webmaster@example.com
DocumentRoot /var/www/html
. . .
&lt;Directory /var/www/html&gt;
        . . .
        AllowOverride All
&lt;/Directory&gt;
. . .
&lt;/VirtualHost&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="section" id="configure-local-drupal-installations">
<h2>Configure local Drupal Installations<a class="headerlink" href="#configure-local-drupal-installations" title="Permalink to this headline">¶</a></h2>
<p>Unfortunately, the configuration and content of a Drupal 7 website seems to be spread throughout the entire Drupal software install. The situation is better with Drupal 8, where content and configuration have been separated. However, Drupal 8 has not yet reached release candidate status (Feb 2015).</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This means that moving a Drupal site to production means zipping up the entire install (plus the Drupal MySQL database) and moving this install to production.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A by-product of this is that development Drupal installs should be kept in individual separate directories within the git software development tree.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple">
<li>This is accomplished by aliasing localhost with a virtual web address in /etc/hosts.
For example, the following line was added to /etc/hosts   &#8220;127.0.0.1  drupal_exercise.com&#8221;. Thus we now have an
alias for localhost called &#8220;drupal_exercise.com&#8221;.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li>The next step is to add &#8220;drupal_exercise.conf&#8221; to the available virtual sites directory &#8220;/etc/apache2/sites-available&#8221;.
Then a logical link is added to &#8220;/etc/apache/sites-enabled&#8221; that links to &#8220;drupal_exercise.conf&#8221;.
The command is:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>ln -s ../sites-available/drupal_exercise.conf drupal_exercise.conf
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A minimal virtual sites file content for &#8220;drupal_exercise.conf&#8221; is:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;VirtualHost *:80&gt;
    ServerName drupal_exercise.com
    ServerAlias www.drupal_exercise.com
    ServerAdmin james.duncan.mcculloch@gmail.com
    DocumentRoot /var/www/html/
    DocumentRoot /var/www/html/drupal_exercise/
    &lt;Directory /var/www/html/drupal_exercise/&gt;
        Options -Indexes +FollowSymLinks
        AllowOverride All
            Order allow,deny
        allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>Using this &#8220;drupal_exercise.conf&#8221; file the Drual install will be in DocumentRoot (/var/www/html/drual_exercise.com). Note that default apache2 document roots are defined in /etc/apache2/apache2.conf.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Using the above setup precedure we can setup as many Drupal installs as required, where required.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="transferring-a-drupal-site">
<h1>Transferring a Drupal Site:<a class="headerlink" href="#transferring-a-drupal-site" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li>Step one. In order to transfer a Drupal site we need to archive (tar) all the html virtual directory files and then transfer these to the virtual host directory of the target machine. For example:</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Source machine</strong></p>
<div class="highlight-python"><div class="highlight"><pre>cd /var/www/html
sudo tar -cvf drupal_exercise.tar drupal_exercise/

(gzipped) sudo tar -zcvf drupal_exercise.tar drupal_exercise/
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Where <strong>drupal_exercise</strong> is exchanged for the virtual host directory of interest. Then this file is transfered to the target machine and the archive file is untarred in the <strong>parent</strong> directory of the relevent virtual host directory. The resultant directory name created by untarring the archive file must match the virtual file name defined in the relevant <strong>.conf</strong> record in the <strong>apache</strong> &#8220;sites-available&#8221; (and linked to &#8220;site-enabled&#8221;) directory. If not, then change the directory name so that they match.</p>
<p><strong>Target machine</strong> (creates a directory &#8220;drupal_exercise&#8221; which must match the virtual host directory)</p>
<div class="highlight-python"><div class="highlight"><pre>cd /var/www/html
sudo tar -xvf drupal_exercise.tar

(gzipped) sudo tar -zxvf drupal_exercise.tar
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li>Step two. Transfer the source Mysql Drupal database to the Mysql Drupal database on the target machine. This is most conveniently done by using <strong>phpmyadmin</strong> to select the source Drupal database (for example, <strong>drupal_exercise</strong>) and dump to selected database to an sql dump file. Transfer this database dump file to the target machine. Use <strong>phpmyadmin</strong> on the target machine to drop/delete the Drupal database if it already exists, then recreate/create the database and import the sql dump file to recreate the Drupal database.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If the Drupal database name and user are the same on the source and target machines then we are finished and the Drupal site should fire up on the target machine. However, if database name and user name have changed then the <strong>sites/default/settings.php</strong> files should be changed. Here is the relevant PHP record (about line 215 in settings.php):</p>
<div class="highlight-python"><div class="highlight"><pre>$databases = array (
&#39;default&#39; =&gt;
array (
    &#39;default&#39; =&gt;
    array (
    &#39;database&#39; =&gt; &#39;drupal_exercise&#39;,
    &#39;username&#39; =&gt; &#39;kellerberrin&#39;,
    &#39;password&#39; =&gt; &#39;d***1&#39;,
    &#39;host&#39; =&gt; &#39;localhost&#39;,
    &#39;port&#39; =&gt; &#39;&#39;,
    &#39;driver&#39; =&gt; &#39;mysql&#39;,
    &#39;prefix&#39; =&gt; &#39;&#39;,
    ),
),
);
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Important! The settings PHP file contains the Mysql database password and should be locked down as tight as possible.</strong></p>
</div>
<div class="section" id="securing-the-drupal-site-after-installation">
<h1>Securing the Drupal Site after installation:<a class="headerlink" href="#securing-the-drupal-site-after-installation" title="Permalink to this headline">¶</a></h1>
<p>Instructions assume that the Drupal virtual host directory is in &#8220;drupal_exercise&#8221;. Change this to actual virtual host directory when following the instructions.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Obviously select a proper and difficult password for Mysql root user and Drupal user. Then establish which account is maintaining the site and what group and user is <strong>apache</strong> running as.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple">
<li>Step One. First of all establish what group and user is apache running as (generally www-data)</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>sudo ps axo user,group,comm | grep apache
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li>Step Two. Make sure all the files have owner root (or whatever user is maintaining the web site - kellerberrin on the development machine) and group www-data so that <strong>apache</strong> can access the files.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>cd /var/www/html
sudo chown -R root:www-data drupal_exercise
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="3">
<li>Step Three. Lock down all the directories.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>sudo find drupal_exercise -type d -exec chmod -R u=rwx,g=rx,o-rwx &#39;{}&#39; \;

or

sudo find drupal_exercise -type d -exec chmod 750 &#39;{}&#39; \;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="4">
<li>Step Four. Lock down all the files.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>sudo find drupal_exercise -type f -exec chmod -R u=rw,g=r,o-rwx &#39;{}&#39; \;

or

sudo find drupal_exercise -type f -exec chmod -R 640 &#39;{}&#39; \;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="5">
<li>Step Five. Lock down all the sub-directories of <strong>sites/default/files</strong>.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>sudo find drupal_exercise/sites/default/files -type d -exec chmod -R ug=rwx,o-rwx &#39;{}&#39; \;

or

sudo find drupal_exercise/sites/default/files -type d -exec chmod -R 770 &#39;{}&#39; \;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="6">
<li>Step Six. Lock down all the files of <strong>sites/default/files</strong>.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>sudo find drupal_exercise/sites/default/files -type f -exec chmod -R ug=rw,o-rwx &#39;{}&#39; \;

or

sudo find drupal_exercise/sites/default/files -type f -exec chmod -R 660 &#39;{}&#39; \;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="7">
<li>Step Seven. Lock down the settings files in <strong>sites/default/settings</strong>.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>sudo chmod ug=r,o-rwx drupal_exercise/sites/default/settings.php

or

sudo chmod 440 drupal_exercise/sites/default/settings.php
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Note that if Drupal needs to modify the settings file (change of database information) then <strong>temporarily</strong> change the permissions to</p>
<div class="highlight-python"><div class="highlight"><pre>sudo chmod ug=rw,o-rwx drupal_exercise/sites/default/settings.php

or

sudo chmod 660 drupal_exercise/sites/default/settings.php
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="local-users-and-passwords">
<h1>Local Users and Passwords:<a class="headerlink" href="#local-users-and-passwords" title="Permalink to this headline">¶</a></h1>
<p>Drupal users and mysql databases are setup according to the drupal install documentation.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Below are typical values for the drupal_exercise.com install described above</p>
<div class="section" id="drupal-admin-user-1">
<h2>Drupal (Admin) User 1<a class="headerlink" href="#drupal-admin-user-1" title="Permalink to this headline">¶</a></h2>
<p>User: admin</p>
<p>Password: &lt;usual password&gt; d***1</p>
</div>
<div class="section" id="phpmyadmin-and-mysql">
<h2>Phpmyadmin and Mysql<a class="headerlink" href="#phpmyadmin-and-mysql" title="Permalink to this headline">¶</a></h2>
<p>The mysql (phpmyadmin) user name and password are:</p>
<p>Drupal database: drupal_exercise</p>
<p>Drupal database user: kellerberrin (setup according to Drupal documentation)</p>
<p>Password: &lt;usual password&gt; d***1</p>
<p>MySql SuperUser: root</p>
<p>Password: &lt;usual password&gt; d***1</p>
</div>
</div>
<div class="section" id="local-drupal-control-scripts">
<h1>Local Drupal Control Scripts:<a class="headerlink" href="#local-drupal-control-scripts" title="Permalink to this headline">¶</a></h1>
<ol class="arabic">
<li><p class="first"><strong>startLamp</strong> - Start the LAMP stack. Apache listens on localhost:80 (or an appropriate alias such as drupal_exercise.com) and MySql is active on port:3306.</p>
<p><a class="reference internal" href="../../_images/emphasize6.png"><img alt="action" src="../../_images/emphasize6.png" style="width: 20pt; height: 20pt;" /></a> (UVIS) $startLamp</p>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic" start="2">
<li><p class="first"><strong>stopLamp</strong> - Stop and unload the LAMP stack (Apache and MySql).</p>
<p><a class="reference internal" href="../../_images/emphasize6.png"><img alt="action" src="../../_images/emphasize6.png" style="width: 20pt; height: 20pt;" /></a> (UVIS) $stopLamp</p>
</li>
</ol>
</div>
<div class="section" id="remote-drupal-server">
<h1>Remote Drupal Server<a class="headerlink" href="#remote-drupal-server" title="Permalink to this headline">¶</a></h1>
<p>Is hosted by Google (IP 130.211.167.94 - This is a static IP address).
Currently has PharmRox.com pointing to the IP address.</p>
<p>Pharmrox.com is setup is a virtual server (see above)</p>
</div>
<div class="section" id="remote-users-and-passwords">
<h1>Remote Users and Passwords:<a class="headerlink" href="#remote-users-and-passwords" title="Permalink to this headline">¶</a></h1>
<div class="section" id="host-unix-account">
<h2>Host unix account<a class="headerlink" href="#host-unix-account" title="Permalink to this headline">¶</a></h2>
<p>The user account is: kellerberrin.
password: &lt;extended non bank password, the final two characters is &#8220;5x&#8221;&gt;</p>
<p>The best way to reach the site is by the <strong>ssh</strong> account.</p>
</div>
<div class="section" id="remote-drupal-user1-superuser">
<h2>Remote Drupal User1 (SuperUser)<a class="headerlink" href="#remote-drupal-user1-superuser" title="Permalink to this headline">¶</a></h2>
<p>User: admin
|
Password: &lt;usual password&gt; d***1</p>
</div>
<div class="section" id="installing-a-local-mail-server">
<h2>Installing a Local Mail Server<a class="headerlink" href="#installing-a-local-mail-server" title="Permalink to this headline">¶</a></h2>
<p>Sending mail from the local Drupal contact page failed.</p>
<p>Googling produced the following solution to install a mail server on the local machine that Drupal can use to send emails.
A shared host will probably have a client mail already installed.</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get install php-pear
sudo pear install mail
sudo pear install Net_SMTP
sudo pear install Auth_SASL
sudo pear install mail_mime
sudo apt-get install postfix
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Kellerberrin Software.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>